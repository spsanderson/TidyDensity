# TidyDensity R Package

TidyDensity is an R package for generating and working with random data
from various probability distributions in a tidy tibble format. The
package provides functions for 40+ statistical distributions with
consistent output format including density, probability, and quantile
functions. Contains 167 R source files with extensive documentation.

Always reference these instructions first and fallback to search or bash
commands only when you encounter unexpected information that does not
match the info here.

## Working Effectively

### Prerequisites and Environment Setup

- Ensure R is installed (version \>= 4.1.0 required). Check with
  `R --version`
- Install R if needed:
  `sudo apt update && sudo apt install -y r-base r-base-dev`
- Set up user R library if needed:
  `mkdir -p ~/R/library && echo 'R_LIBS_USER=~/R/library' >> ~/.Renviron`

### Essential R Package Dependencies

Install required packages for development (NEVER CANCEL - may take 10+
minutes for all dependencies):

``` bash
# Set timeout to 30+ minutes for package installation
Rscript -e "install.packages(c('devtools', 'knitr', 'rmarkdown', 'testthat', 'pkgdown'), repos='https://cloud.r-project.org/', lib='~/R/library')"
```

### Core Development Workflow

#### Building the Package

- `R CMD build .` – builds the package tarball. Takes 2-3 minutes. NEVER
  CANCEL.
- For clean build without vignettes:
  `R CMD build --no-build-vignettes .` – VALIDATED: takes \<1 minute
- TESTED: Build without vignettes completes in under 1 minute and works
  correctly

#### Checking the Package

- `R CMD check .` – comprehensive package check. Takes 5-10 minutes.
  NEVER CANCEL. Set timeout to 20+ minutes.
- Quick check without vignettes:
  `R CMD check --no-vignettes --no-manual .`
- TESTED: Check requires all dependencies to be installed first
- The package has extensive documentation (167 R files) so checking
  takes time
- NOTE: Package check will fail until dependencies are installed - this
  is expected

#### Installing the Package

- `R CMD INSTALL .` – installs package locally. Takes 2-5 minutes.
- Install with dependencies:
  `Rscript -e "devtools::install('.', dependencies=TRUE)"`

#### Documentation Generation

- Generate documentation: `Rscript -e "devtools::document()"` – takes
  2-3 minutes
- Build pkgdown site: `Rscript -e "pkgdown::build_site()"` – takes 5-10
  minutes. NEVER CANCEL.

## Validation and Testing

### Manual Testing Workflow

Always test core functionality after making changes:

``` r
# Load the package and test basic functionality
library(TidyDensity)

# Test basic distribution generation
normal_data <- tidy_normal(.n = 100, .num_sims = 5)
print(head(normal_data))

# Test plotting functionality  
plot_result <- tidy_autoplot(normal_data, .plot_type = "density")
print(plot_result)

# Test different distribution types
beta_data <- tidy_beta(.n = 50, .shape1 = 2, .shape2 = 3)
gamma_data <- tidy_gamma(.n = 50, .shape = 2, .rate = 1)
```

### Package Structure Validation

- The package has no formal test suite (no tests/ directory)
- Instead, test using examples in documentation files
- Run examples: `Rscript -e "example(tidy_normal)"`
- Validate vignettes:
  `Rscript -e "rmarkdown::render('vignettes/getting-started.Rmd')"`

## Repository Structure and Navigation

### Key Directories and Files

    /home/runner/work/TidyDensity/TidyDensity/
    ├── DESCRIPTION              # Package metadata and dependencies
    ├── NAMESPACE               # Exported functions (generated by roxygen2)
    ├── R/                      # All R source code (167 files)
    │   ├── random-tidy-*.R     # Main distribution functions
    │   ├── autoplot*.R         # Plotting functions
    │   ├── est-param-*.R       # Parameter estimation functions
    │   ├── stats-*-tbl.R       # Statistics table functions
    │   └── utils-*.R           # Utility functions
    ├── man/                    # Documentation files (175 .Rd files, generated)
    ├── vignettes/              # Package vignettes (1 file)
    ├── docs/                   # pkgdown website files
    ├── README.Rmd              # README source (generates README.md)
    └── _pkgdown.yml            # Website configuration

### Package Structure Analysis Commands

- Count R files: `ls R/*.R | wc -l` (expect 167)
- Count documentation: `ls man/*.Rd | wc -l` (expect 175)
- List vignettes: `ls vignettes/*.Rmd` (expect 1 file)
- Check file structure:
  `Rscript -e "cat('R files:', length(list.files('R', pattern='*.R')), '\\nMan pages:', length(list.files('man', pattern='*.Rd')), '\\n')"`

### Important File Patterns

- Main distribution functions: `R/random-tidy-*.R`
- Plotting functions: `R/autoplot*.R` and `R/*plot*.R`
- Parameter estimation: `R/est-param-*.R`
- Statistics: `R/stats-*.R`
- Documentation: Files ending in `.Rd` in `man/`

### Common Locations

- **Distribution functions**: Look in `R/random-tidy-[distribution].R`
- **Plot customization**: Check `R/autoplot*.R` files
- **Parameter estimation**: Found in `R/est-param-*.R`
- **Examples**: In roxygen comments of R files or vignettes/
- **Dependencies**: Listed in DESCRIPTION file

## Build Timing and Expectations

### Command Timeouts (CRITICAL - NEVER CANCEL)

- **Package build**: 2-3 minutes normally, up to 5 minutes with
  vignettes
- **Package check**: 5-10 minutes for full check, 15+ minutes with all
  tests
- **Package installation**: 2-5 minutes
- **Documentation generation**: 2-3 minutes  
- **pkgdown site build**: 5-10 minutes due to many functions
- **Dependency installation**: 10-30 minutes for all packages

### Always Use These Timeouts

- `R CMD build`: Set timeout to 10+ minutes
- `R CMD check`: Set timeout to 20+ minutes  
- [`pkgdown::build_site()`](https://pkgdown.r-lib.org/reference/build_site.html):
  Set timeout to 15+ minutes
- Package installations: Set timeout to 30+ minutes

## Common Development Tasks

### Adding New Distribution Functions

1.  Create new file: `R/random-tidy-[name].R`
2.  Follow existing pattern from `R/random-tidy-normal.R`
3.  Add corresponding documentation with `@examples`
4.  Update NAMESPACE via
    [`devtools::document()`](https://rdrr.io/pkg/devtools/man/document.html)
5.  Add parameter estimation in `R/est-param-[name].R`
6.  Add statistics table in `R/stats-[name]-tbl.R`

### Modifying Existing Functions

1.  Edit the relevant R file in `R/`
2.  Update documentation if needed
3.  Run
    [`devtools::document()`](https://rdrr.io/pkg/devtools/man/document.html)
    to update man pages
4.  Test with example code
5.  Run `R CMD check` to validate

### Working with Plots

- Main plotting function:
  [`tidy_autoplot()`](https://www.spsanderson.com/TidyDensity/reference/tidy_autoplot.md)
  in `R/autoplot.R`
- Multiple plot types: “density”, “quantile”, “probability”, “qq”
- Color schemes in `R/palette-color-blind.R`
- Always test plots by generating actual output

### Documentation Updates

- README source is in `README.Rmd` (NOT README.md)
- Edit README.Rmd then run:
  `Rscript -e "rmarkdown::render('README.Rmd')"`
- Vignettes are in `vignettes/` directory
- Function docs are in roxygen comments in R files

## Troubleshooting

### Common Issues

- **“Author/Maintainer missing”**: Use newer R version or ignore for
  development
- **Vignette build failures**: Install knitr and rmarkdown packages
- **Network timeouts**: Use `options(timeout=300)` in R for longer
  downloads
- **Permission errors**: Install packages to user library with
  `lib='~/R/library'`

### Validation Checklist

Before completing work, always: - \[ \] Run
`R CMD build --no-build-vignettes .` successfully (should take \<1
minute) - \[ \] Verify package structure: `ls R/*.R | wc -l` (expect 167
files) - \[ \] Check documentation count: `ls man/*.Rd | wc -l` (expect
175 files) - \[ \] Test basic R stats:
`Rscript -e "set.seed(123); print(rnorm(5))"` - \[ \] Validate README
structure: `file README.Rmd README.md` - \[ \] Check pkgdown config
exists: `head -3 _pkgdown.yml` - \[ \] If dependencies available: Test
distribution function and plotting - \[ \] If dependencies available:
Run `R CMD check` successfully

### Complete Manual Test Scenario (when dependencies available)

``` r
# Complete validation workflow
library(TidyDensity)

# Test basic distribution
normal_data <- tidy_normal(.n = 50, .num_sims = 3)
print(dim(normal_data))  # Should show 150 rows, 7 columns
print(unique(normal_data$sim_number))  # Should show 1, 2, 3

# Test plotting
plot_result <- tidy_autoplot(normal_data, .plot_type = "density")
print(class(plot_result))  # Should show ggplot class

# Test different distributions
gamma_data <- tidy_gamma(.n = 25, .shape = 2, .rate = 1)
beta_data <- tidy_beta(.n = 25, .shape1 = 2, .shape2 = 3)

print("All tests completed successfully")
```

### Package Dependencies (Reference)

Key dependencies from DESCRIPTION: - **Core**: dplyr, ggplot2, tidyr,
purrr, magrittr - **Statistics**: actuar, stats, survival, nloptr,
broom - **Visualization**: plotly, patchwork - **Development**: knitr,
rmarkdown (for vignettes)

Always check DESCRIPTION file for complete dependency list and version
requirements.

## Working Without Full Dependencies

### Offline Development Mode

When internet access is limited or dependencies cannot be installed: -
Use `R CMD build --no-build-vignettes .` for building (TESTED - works) -
Skip package checks until dependencies are available - Test basic R
functionality: `Rscript -e "set.seed(123); x <- rnorm(10); print(x)"` -
Count R files: `ls R/*.R | wc -l` (should show 167 files) - Examine
individual R files for function structure and examples

### Dependency Installation Issues

If you encounter “package not available” errors: 1. Check internet
connectivity 2. Try different CRAN mirrors 3. Set longer timeout:
`options(timeout=300)` 4. Install to user library:
`install.packages(..., lib='~/R/library')` 5. Use package manager URLs
like ‘<https://packagemanager.rstudio.com/all/latest>’
