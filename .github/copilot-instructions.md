# Copilot Instructions for TidyDensity

## Repository Overview

**TidyDensity** is an R package that provides functions for tidy analysis and generation of random data from statistical distributions. The package makes working with random numbers from different distributions easy by returning all data in a tidy tibble format, making it compatible with the tidyverse ecosystem.

- **Language**: R
- **Type**: R Package (CRAN package)
- **Current Version**: 1.5.1.9000 (development)
- **Target Runtime**: R >= 4.1.0
- **License**: MIT
- **Size**: ~140+ R source files, comprehensive documentation

## Quick Start Commands

### Essential Build Commands
```bash
# Build the package (requires R and dependencies)
R CMD build .

# Check package for CRAN compliance
R CMD check TidyDensity_*.tar.gz

# Install package dependencies (in R)
install.packages(c("devtools", "roxygen2", "knitr", "rmarkdown"))

# Build documentation
R -e "roxygen2::roxygenise()"

# Build pkgdown site
R -e "pkgdown::build_site()"
```

### Required Environment Setup
```bash
# Install R (Ubuntu/Debian)
sudo apt update
sudo apt install -y r-base r-base-dev

# Required system dependencies for R packages
sudo apt install -y libcurl4-openssl-dev libssl-dev libxml2-dev
```

**IMPORTANT**: Always install R dependencies before attempting to build. The package has many dependencies and building without them will fail.

### Installation and Loading
```r
# From CRAN (stable)
install.packages("TidyDensity")

# From GitHub (development)
devtools::install_github("spsanderson/TidyDensity")

# Load package
library(TidyDensity)
```

## Project Architecture

### Core Directory Structure
```
/
├── R/                          # Source code (140+ files)
│   ├── random-tidy-*.R        # Main distribution functions
│   ├── est-param-*.R          # Parameter estimation functions
│   ├── stats-*.R              # Distribution statistics
│   ├── autoplot*.R            # Plotting functions
│   ├── utils-*.R              # Utility functions
│   └── bootstrap-*.R          # Bootstrap functions
├── man/                       # Generated documentation
├── vignettes/                 # Package vignettes
│   └── getting-started.Rmd    # Main tutorial
├── docs/                      # pkgdown website (generated)
├── DESCRIPTION                # Package metadata
├── NAMESPACE                  # Exported functions (generated)
├── _pkgdown.yml              # Website configuration
└── TidyDensity.Rproj         # RStudio project
```

### Key Configuration Files
- **DESCRIPTION**: Package metadata, dependencies, version info
- **NAMESPACE**: Auto-generated by roxygen2 - DO NOT edit manually
- **_pkgdown.yml**: Website structure and theming
- **.Rbuildignore**: Files to exclude from package builds

### Source Code Organization
The R source files follow clear naming conventions:
- `random-tidy-[distribution].R`: Core functions like `tidy_normal()`, `tidy_beta()`
- `est-param-[distribution].R`: Parameter estimation utilities
- `stats-[distribution]-tbl.R`: Statistical summary functions
- `autoplot*.R`: Visualization functions using ggplot2
- `utils-*.R`: Helper functions and utilities

## Dependencies

### Required R Packages
Core dependencies (automatically installed):
- **tidyverse ecosystem**: dplyr, ggplot2, tidyr, purrr, tidyselect
- **Statistical**: stats, actuar, survival, EnvStats (suggested)
- **Utilities**: magrittr, rlang, methods, stringr, data.table
- **Visualization**: plotly, patchwork
- **Optimization**: nloptr, broom

### Build Dependencies
Required for development/building:
- **roxygen2**: Documentation generation
- **knitr**: Vignette building
- **rmarkdown**: R Markdown processing
- **devtools**: Development tools
- **pkgdown**: Website generation

## Build and Development Workflow

### Documentation Generation
```bash
# Generate all documentation (always run before building)
R -e "roxygen2::roxygenise()"

# Build vignettes (requires knitr)
R -e "devtools::build_vignettes()"

# Build website
R -e "pkgdown::build_site()"
```

### Package Building
```bash
# Standard build process
R CMD build .                    # Creates TidyDensity_x.x.x.tar.gz
R CMD check TidyDensity_*.tar.gz # Full CRAN checks

# Quick checks during development
R -e "devtools::check()"         # Fast check
R -e "devtools::test()"          # Run tests (if any)
```

### Common Build Issues and Solutions

**Issue**: `vignette builder 'knitr' not found`
```bash
# Solution: Install knitr first
R -e "install.packages('knitr')"
```

**Issue**: Missing system dependencies
```bash
# Install common R package dependencies
sudo apt install -y libcurl4-openssl-dev libssl-dev libxml2-dev
```

**Issue**: Permission denied during package installation
```bash
# Use sudo for system-wide installation
sudo R -e "install.packages('packagename')"
```

### Development Best Practices
1. **Always run `roxygen2::roxygenise()`** before building to update documentation
2. **Update NEWS.md** when making changes
3. **Respect the existing file naming conventions** in R/
4. **Use roxygen2 comments** for all exported functions
5. **Test examples** in documentation work properly

## Package Functionality

### Core Functions
The package provides "tidy" versions of statistical distribution functions:

**Distribution Functions** (return tibbles):
- `tidy_normal()`, `tidy_beta()`, `tidy_gamma()`, etc.
- Each provides: random values, density, quantile, and probability functions

**Visualization Functions**:
- `tidy_autoplot()`: Automatic plotting for any tidy distribution
- `tidy_combined_autoplot()`: Plot multiple distributions
- Support for density, quantile, probability, and Q-Q plots

**Parameter Estimation**:
- `util_[distribution]_param_estimate()`: Estimate parameters from data
- AIC calculation utilities for model comparison

**Bootstrap Functions**:
- `tidy_bootstrap()`: Bootstrap sampling
- Bootstrap-based confidence intervals and statistics

### Data Structure
All functions return tibbles with consistent column structure:
- `sim_number`: Simulation identifier
- `x`: Index/sequence number
- `y`: Random generated values
- `dx`, `dy`: Density function values
- `p`: Cumulative probability values
- `q`: Quantile values

## Validation and Testing

### Manual Testing Process
Since there's no formal test suite, validate changes by:

1. **Build the package**: `R CMD build .`
2. **Run CRAN checks**: `R CMD check TidyDensity_*.tar.gz`
3. **Test core functions**:
   ```r
   library(TidyDensity)
   
   # Test basic functionality
   tn <- tidy_normal(.n = 100, .num_sims = 3)
   head(tn)
   
   # Test plotting
   tidy_autoplot(tn, .plot_type = "density")
   ```

4. **Verify documentation**: Check that examples in help files work
5. **Test vignettes**: Ensure vignettes knit without errors

### Performance Expectations
- Package build: ~30-60 seconds (depending on system)
- Basic function calls: Nearly instantaneous
- Large simulations (n > 10000): May take several seconds
- Documentation generation: ~10-20 seconds

## Common Troubleshooting

### Build Failures
1. **Missing dependencies**: Install all required packages first
2. **Documentation errors**: Run `roxygen2::roxygenise()` to regenerate
3. **Namespace conflicts**: Check NAMESPACE file is auto-generated
4. **Vignette building**: Ensure knitr and rmarkdown are installed

### Runtime Issues
1. **Function not found**: Check package is loaded with `library(TidyDensity)`
2. **Plotting errors**: Ensure ggplot2 and dependencies are available
3. **Memory issues**: Reduce `.n` or `.num_sims` parameters for large datasets

## File Layout Reference

### Root Directory Files
- `DESCRIPTION`: Package metadata and dependencies
- `NAMESPACE`: Exported functions (auto-generated)
- `LICENSE`, `LICENSE.md`: MIT license files
- `README.md`, `README.Rmd`: Package introduction and examples
- `NEWS.md`: Version history and changes
- `cran-comments.md`: CRAN submission notes
- `_pkgdown.yml`: Website configuration
- `TidyDensity.Rproj`: RStudio project settings

### Generated/Build Directories
- `docs/`: pkgdown website (can be regenerated)
- `man/`: Help files (auto-generated by roxygen2)

**Important**: Trust these instructions and avoid extensive exploration. Only search for additional information if these instructions are incomplete or incorrect. The package follows standard R package conventions, so most standard R development practices apply.